<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="scripts/read_excel_file.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <title>Дашборд</title>
</head>

<header data-bs-theme="dark">
    <nav class="navbar" style="background-color:#1d3653;">
        <div class="container">
            <input class="form-control form-control-sm" type="file" id="input" onchange="get_data()">
        </div>
    </nav>
</header>

<body>

    <div class="container" style="margin-top: 15px;">
        <div id="tbl-stats" class="tbl-stats" style="width: 50%">
            <div class="card-group">
                <div class="card" style="width: 18rem">
                    <svg class="bd-placeholder-img card-img-top" width="100%" height="180"
                        xmlns="http://www.w3.org/2000/svg" role="img" aria-label="BSS"
                        preserveAspectRatio="xMidYMid slice" focusable="false">
                        <rect width="100%" height="100%" fill="rgb(0, 100, 158)"></rect>
                        <text font-size="200%" font-weight="bold" x="50%" y="50%" fill="#FFF" dx="-1em" dy="-.5em">
                            BSS
                        </text>
                        <text id="bss_stats" font-size="200%" x="50%" y="50%" fill="#FFF" dx="-0.7em" dy="1em">0</text>
                    </svg>
                    <div class="card-body">
                        <h5 class="card-title">Услуга востановлена: ДА</h5>
                        <div class="progress" role="progressbar" aria-label="Success example" aria-valuenow="25"
                            aria-valuemin="0" aria-valuemax="100">
                            <div id="bss_y_stats" class="progress-bar bg-success" style="width: 100%">0</div>
                        </div>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            Высокий 0-1: <span id="bss_y_h_stats" class="badge bg-danger">0</span><br />
                            Средний 2-3: <span id="bss_y_m_stats" class="badge"
                                style=" background-color: #ff7300;">0</span><br />
                            Минимальный 4-5: <span id="bss_y_l_stats" class="badge bg-success">0</span>
                        </li>
                    </ul>
                    <div class="card-body">
                        <h5 class="card-title">Услуга востановлена: НЕТ</h5>
                        <div class="progress" role="progressbar" aria-label="Success example" aria-valuenow="25"
                            aria-valuemin="0" aria-valuemax="100">
                            <div id="bss_n_stats" class="progress-bar" style="width: 100%; background-color: #ff7300;">0
                            </div>
                        </div>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            Высокий 0-1: <span id="bss_n_h_stats" class="badge bg-danger">0</span><br />
                            Средний 2-3: <span id="bss_n_m_stats" class="badge"
                                style=" background-color: #ff7300;">0</span><br />
                            Минимальный 4-5: <span id="bss_n_l_stats" class="badge bg-success">0</span>
                        </li>
                    </ul>
                </div>
                <div class="card" style="width: 18rem">
                    <svg class="bd-placeholder-img card-img-top" width="100%" height="180"
                        xmlns="http://www.w3.org/2000/svg" role="img" aria-label="КРУС"
                        preserveAspectRatio="xMidYMid slice" focusable="false">
                        <rect width="100%" height="100%" fill="#b58816"></rect>
                        <text font-size="200%" font-weight="bold" x="50%" y="50%" fill="#FFF" dx="-1em" dy="-.5em">
                            КРУС
                        </text>
                        <text id="krus_stats" font-size="200%" x="50%" y="50%" fill="#FFF" dx="-.5em" dy="1em">0</text>
                    </svg>
                    <div class="card-body">
                        <h5 class="card-title">Услуга востановлена: ДА</h5>
                        <div class="progress" role="progressbar" aria-label="Success example" aria-valuenow="25"
                            aria-valuemin="0" aria-valuemax="100">
                            <div id="krus_y_stats" class="progress-bar bg-success" style="width: 100%">0</div>
                        </div>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            Высокий 0-1: <span id="krus_y_h_stats" class="badge bg-danger">0</span><br />
                            Средний 2-3: <span id="krus_y_m_stats" class="badge"
                                style=" background-color: #ff7300;">0</span><br />
                            Минимальный 4-5: <span id="krus_y_l_stats" class="badge bg-success">0</span>
                        </li>
                    </ul>
                    <div class="card-body">
                        <h5 class="card-title">Услуга востановлена: НЕТ</h5>
                        <div class="progress" role="progressbar" aria-label="Success example" aria-valuenow="25"
                            aria-valuemin="0" aria-valuemax="100">
                            <div id="krus_n_stats" class="progress-bar" style="width: 100%; background-color: #ff7300;">
                                0</div>
                        </div>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            Высокий 0-1: <span id="krus_n_h_stats" class="badge bg-danger">0</span><br />
                            Средний 2-3: <span id="krus_n_m_stats" class="badge"
                                style=" background-color: #ff7300;">0</span><br />
                            Минимальный 4-5: <span id="krus_n_l_stats" class="badge bg-success">0</span>
                        </li>
                    </ul>
                </div>
                <svg class="bd-placeholder-img card-img-top" width="100%" height="50" xmlns="http://www.w3.org/2000/svg"
                    role="img" aria-label="BSS" preserveAspectRatio="xMidYMid slice" focusable="false">
                    <title></title>
                    <rect width="100%" height="100%" fill="#8e3ac2"></rect>
                    <text id="all_stats" font-size="200%" font-weight="bold" x="50%" y="50%" fill="#FFF" dx="-1.5em"
                        dy=".3em">
                        Всего: 0
                    </text>
                </svg>
            </div>
        </div>
    </div>
    <div class="container" style="margin-top: 15px;">
        <div id="tbl-data" style="text-align: center;"></div>
    </div>


</body>
<script>
    const input = document.getElementById("input");
    const output = document.getElementById("tbl-data");
    const dash = document.getElementById("tbl-stats");
    const bss_stats = document.getElementById("bss_stats");
    const bss_y_stats = document.getElementById("bss_y_stats");
    const bss_y_h_stats = document.getElementById("bss_y_h_stats");
    const bss_y_m_stats = document.getElementById("bss_y_m_stats");
    const bss_y_l_stats = document.getElementById("bss_y_l_stats");
    const bss_n_stats = document.getElementById("bss_n_stats");
    const bss_n_h_stats = document.getElementById("bss_n_h_stats");
    const bss_n_m_stats = document.getElementById("bss_n_m_stats");
    const bss_n_l_stats = document.getElementById("bss_n_l_stats");
    const krus_stats = document.getElementById("krus_stats");
    const krus_y_stats = document.getElementById("krus_y_stats");
    const krus_y_h_stats = document.getElementById("krus_y_h_stats");
    const krus_y_m_stats = document.getElementById("krus_y_m_stats");
    const krus_y_l_stats = document.getElementById("krus_y_l_stats");
    const krus_n_stats = document.getElementById("krus_n_stats");
    const krus_n_h_stats = document.getElementById("krus_n_h_stats");
    const krus_n_m_stats = document.getElementById("krus_n_m_stats");
    const krus_n_l_stats = document.getElementById("krus_n_l_stats");
    const all_stats = document.getElementById("all_stats");

    function get_data() {
        readXlsxFile(input.files[0]).then(function (data) {
            view_stats(data);
            //view_table(data);
            // console.log(data);
        })
    }
    function view_stats(data) {
        all_stats.innerHTML = "Всего: " + (data.length - 1);
        var count_bss = 0,
            count_krus = 0,
            count_bss_y = 0,
            count_krus_y = 0,
            count_bss_n = 0,
            count_krus_n = 0,
            count_bss_y_h = 0,
            count_krus_y_h = 0,
            count_bss_n_h = 0,
            count_krus_n_m = 0,
            count_bss_y_m = 0,
            count_krus_y_m = 0,
            count_bss_n_m = 0,
            count_krus_n_m = 0,
            count_bss_y_l = 0,
            count_krus_y_l = 0,
            count_bss_n_l = 0,
            count_krus_n_l = 0,
            th_bil = 0,
            th_sr = 0,
            th_prior = 0;
        for (var row = 0; row < data.length; row++) {
            for (var col = 0; col < data[row].length; col++) {
                if (data[0][col] == 'BIL') { th_bil = col; }
                if (data[0][col] == 'Услуга Восстановлена') { th_sr = col; }
            }
            var if_bss = data[row][th_bil] == 'BSS',
                if_krus = data[row][th_bil] == 'КРУС',
                if_y = data[row][th_sr] == 'Да',
                if_n = data[row][th_sr] == 'Нет',
                if_h = (data[row][th_prior] == '0')||(data[row][th_prior] == '1'),
                if_m = (data[row][th_prior] == '2')||(data[row][th_prior] == '3'),
                if_l = (data[row][th_prior] == '4')||(data[row][th_prior] == '5');
                
            if (if_bss) { count_bss++ }
            if (if_krus) { count_krus++ }
            if (if_y && if_bss) { count_bss_y++;}
            if (if_y && if_krus) { count_krus_y++;}
            if (if_n && if_bss) { count_bss_n++;}
            if (if_n && if_krus) { count_krus_n++;}
            if (if_h && if_y && if_bss) { count_bss_y_h++;}
            if (if_h && if_y && if_krus) { count_krus_y_h++;}
            if (if_h && if_n && if_bss) { count_bss_n_h++;}
            if (if_h && if_n && if_krus) { count_krus_n_m++;}
            if (if_m && if_y && if_bss) { count_bss_y_m++;}
            if (if_m && if_y && if_krus) { count_krus_y_m++;}
            if (if_m && if_n && if_bss) { count_bss_n_m++;}
            if (if_m && if_n && if_krus) { count_krus_n_m++;}
            if (if_l && if_y && if_bss) { count_bss_y_l++;}
            if (if_l && if_y && if_krus) { count_krus_y_l++;}
            if (if_l && if_n && if_bss) { count_bss_n_l++;}
            if (if_l && if_n && if_krus) { count_krus_n_l++;}
            
        }
        bss_stats.innerHTML = count_bss;
        krus_stats.innerHTML = count_krus;
        bss_y_stats.innerHTML = count_bss_y; 
        krus_y_stats.innerHTML = count_krus_y;
        bss_n_stats.innerHTML = count_bss_n; 
        krus_n_stats.innerHTML = count_krus_n;
    }
    function view_table(data) {
        console.log(data);
        var table = document.createElement("table");
        for (var row = 0; row < data.length; row++) {
            if (row == 0) {
                var tr_table = document.createElement("tr");
                for (var col = 0; col < data[row].length; col++) {
                    var td_table = document.createElement("th");
                    td_table.style = 'font-weight: bold; border: 1px solid;';
                    td_table.innerHTML = data[row][col];
                    tr_table.appendChild(td_table);
                }
            } else {
                var tr_table = document.createElement("tr");
                for (var col = 0; col < data[row].length; col++) {
                    var th_comment;
                    if (data[0][col] == 'COMMENTS') { th_comment = col; }
                    var td_table = document.createElement("td");
                    td_table.style = "border: 1px solid;";
                    if (col != th_comment) { td_table.innerHTML = data[row][col]; }

                    tr_table.appendChild(td_table);
                }
            }
            table.appendChild(tr_table);
        }
        output.appendChild(table);

    }

</script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
    integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
    crossorigin="anonymous"></script>

</html>
